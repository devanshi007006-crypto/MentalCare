<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MindCare Login/Register</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" rel="stylesheet">
</head>
<body class="center-page">
    <div class="card login-card">
        <h1 id="formTitle">Welcome Back</h1>
        <p class="subtitle" id="formSubtitle">
            Please log in to continue.
        </p>

       <form id="authForm">
        <div class="input-group">
    <label for="email">Email</label><i class="fas fa-envelope icon"></i>
    <input type="email" id="email" required placeholder="name@example.com" pattern="[a-z0-9._%+\-]+@[a-z0-9.\-]+\.[a-z]{2,}$">

    <label for="password">Password</label><i class="fas fa-lock icon"></i>
    <input type="password" id="password" required minlength="5" placeholder="enter your password" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{5,}"
    title="Must contain at least one number and one uppercase and lowercase letter, and at least 5 or more characters">

    <div id="confirmPasswordGroup" class="hidden">
        <label for="confirmPassword">Confirm Password</label>
        <input type="password" id="confirmPassword" minlength="5" placeholder="confirm your password" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{5,}"
        title="Must contain at least one number and one uppercase and lowercase letter, and at least 5 or more characters">
    </div>
</div>
    <div class="form-options">
        <label class="checkbox-container">
            <input type="checkbox" id="rememberMe">
            Remember Me
            <span class="checkmark"></span>
        </label>
        <a href="#" id="forgotPassword" class="btn-link-sm">Forgot Password?</a>
    </div>
    
    <div id="message"></div>

    <button type="submit" id="submitButton" class="btn-primary">Login</button>
</form>

<button id="toggleButton" class="btn-link">Need an account? Register Here</button>

<p class="note"> 
    New credentials will be saved in this browser only.
</p>
    </div>

    <script>
        // Define storage key and a default demo user
    const STORAGE_KEY = 'mindcare-users';
    const DEMO_EMAIL = 'student@demo.com'; // New demo email
    const DEMO_PASSWORD = '1234';          // Existing demo password (4 chars)
    const REMEMBER_ME_KEY = 'mindcare-remember-email';

    let isRegisterMode = false;

    // Get elements
    const formTitle = document.getElementById('formTitle');
    const formSubtitle = document.getElementById('formSubtitle');
    const authForm = document.getElementById('authForm');
    const emailInput = document.getElementById('email'); // Updated ID
    const passwordInput = document.getElementById('password');
    const confirmPasswordGroup = document.getElementById('confirmPasswordGroup');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const messageDiv = document.getElementById('message');
    const submitButton = document.getElementById('submitButton');
    const toggleButton = document.getElementById('toggleButton');
    
    // NEW ELEMENTS
    const rememberMeCheckbox = document.getElementById('rememberMe');
    const forgotPasswordLink = document.getElementById('forgotPassword');

    // --- Core Functions ---

    // 1. Load users from localStorage or set default
    let users = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
    // Ensure demo user exists
    if (!users[DEMO_EMAIL]) {
        users[DEMO_EMAIL] = DEMO_PASSWORD;
        localStorage.setItem(STORAGE_KEY, JSON.stringify(users));
    }

    function toggleMode(toRegister) {
        isRegisterMode = toRegister;
        if (isRegisterMode) {
            formTitle.textContent = 'Join MindCare';
            formSubtitle.textContent = 'Create your private account.';
            confirmPasswordGroup.classList.remove('hidden');
            confirmPasswordInput.setAttribute('required', 'required');
            submitButton.textContent = 'Register';
            toggleButton.textContent = 'Already have an account? Login Here';
        } else {
            formTitle.textContent = 'Welcome Back';
            formSubtitle.textContent = 'Please log in to continue.';
            confirmPasswordGroup.classList.add('hidden');
            confirmPasswordInput.removeAttribute('required');
            submitButton.textContent = 'Login';
            toggleButton.textContent = 'Need an account? Register Here';
        }
    }

    // 2. Remember Me Logic (Load)
    function loadRememberedEmail() {
        const rememberedEmail = localStorage.getItem(REMEMBER_ME_KEY);
        if (rememberedEmail) {
            emailInput.value = rememberedEmail;
            rememberMeCheckbox.checked = true;
        }
    }

    // 3. Form Submission Handler
    authForm.addEventListener('submit', function (e) {
        e.preventDefault();
        messageDiv.textContent = ''; // Clear previous messages

        const u = emailInput.value.trim();
        const p = passwordInput.value.trim();

        if (u.length < 4 || p.length < 4) {
            messageDiv.textContent = "Email and password must be at least 4 characters long.";
            return;
        }

        // Registration Logic
        if (isRegisterMode) {
            const pc = confirmPasswordInput.value.trim();

            if (p !== pc) {
                messageDiv.textContent = "Error: Passwords do not match.";
                return;
            }
            
            if (users[u]) {
                messageDiv.textContent = "Error: This email is already registered.";
                return;
            }

            // REGISTRATION SUCCESS
            users[u] = p; // Store the new user
            localStorage.setItem(STORAGE_KEY, JSON.stringify(users));
            messageDiv.textContent = `Success! User '${u}' registered. Logging in...`;
            
            // Auto-login and redirect
            setTimeout(() => {
                window.location.href = "home.html";
            }, 1000);

        } else {
            // LOGIN MODE
            if (users[u] === p) {
                // LOGIN SUCCESS
                
                // Remember Me Logic (Save)
                if (rememberMeCheckbox.checked) {
                    localStorage.setItem(REMEMBER_ME_KEY, u);
                } else {
                    localStorage.removeItem(REMEMBER_ME_KEY);
                }
                
                window.location.href = "home.html";
            } else {
                // LOGIN FAILURE
                messageDiv.textContent = "Incorrect email or password.";
            }
        }
    });

    // 4. Toggle Mode Button
    toggleButton.addEventListener('click', function() {
        toggleMode(!isRegisterMode);
    });

    // 5. Forgot Password Handler (DEMO ONLY)
    forgotPasswordLink.addEventListener('click', function(e) {
        e.preventDefault();
        alert("This is a demo. In a real application, you would be taken to a page to request a password reset link be sent to your email.");
    });


    // Initialize on load
    toggleMode(false);
    loadRememberedEmail(); // Load remembered email on startup
    </script>
</body>
</html>
